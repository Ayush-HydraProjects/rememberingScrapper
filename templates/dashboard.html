<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obituary Scraper Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
          integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <script>
        let scrapingActive = {{ scraping_active|tojson }};
        console.log("Initial scrapingActive:", scrapingActive); // Should log true/false
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body class="bg-gray-100">

<!-- Announcement Bar -->
<div class="bg-yellow-100 border-b border-yellow-200 text-sm px-4 py-2 text-center">
    ‚ö†Ô∏è <strong class="font-semibold">Educational Purpose:</strong> This dashboard is for educational purposes. Obituary
    data is sourced from <a href="https://www.remembering.ca/" target="_blank"
                           class="underline text-blue-500">remembering.ca</a>.
</div>

<!-- Header -->
<header class="bg-white shadow-md py-4">
    <div class="container mx-auto px-6 flex justify-between items-center">
        <div class="text-xl font-bold text-gray-800">üìñ Obituary Scraper Dashboard</div>
        <nav class="space-x-4">
            <a href="/" class="hover:text-gray-600">üè† Dashboard</a>
            <!--            <a href="/settings" class="hover:text-gray-600">‚öôÔ∏è Settings</a>-->
            <a href="/about" class="hover:text-gray-600">‚ÑπÔ∏è About</a>
        </nav>
    </div>
</header>

<div class="container mx-auto px-6 mt-6 flex">
    <!-- Sidebar - Advanced Filters -->
    <aside class="w-72 mr-6 p-6 bg-white rounded-lg shadow-md h-fit sticky top-6">
        <h3 class="font-semibold text-xl mb-5 text-gray-800"><i class="fas fa-filter mr-2 text-blue-500"></i> Filter
            Obituaries</h3>
        <form id="filterForm" class="space-y-6">
            <!-- Increased vertical spacing -->
            <div>
                <label for="firstNameFilter" class="block text-gray-700 text-sm font-medium mb-2">
                    <i class="fas fa-user mr-1 text-gray-500"></i> First Name:
                </label>
                <input type="text" class="form-input" id="firstNameFilter" name="firstName" placeholder="Enter first name"
                       value="{{ request.args.firstName }}">
            </div>
            <div>
                <label for="lastNameFilter" class="block text-gray-700 text-sm font-medium mb-2">
                    <i class="fas fa-user mr-1 text-gray-500"></i> Last Name:
                </label>
                <input type="text" class="form-input" id="lastNameFilter" name="lastName" placeholder="Enter last name"
                       value="{{ request.args.lastName }}">
            </div>
            <div>
                <label for="cityFilter" class="block text-gray-700 text-sm font-medium mb-2">
                    <i class="fas fa-city mr-1 text-gray-500"></i> City:
                </label>
                <input type="text" class="form-input" id="cityFilter" name="city" placeholder="Enter city name"
                       value="{{ request.args.city }}">
            </div>
            <div>
                <label for="provinceFilter" class="block text-gray-700 text-sm font-medium mb-2">
                    <i class="fas fa-map-marker-alt mr-1 text-gray-500"></i> Province:
                </label>
                <select id="provinceFilter" class="form-select bg-gray-50" name="province">
                    <!-- Added light background -->
                    <option value="">Select Province</option>
                    <!-- Updated placeholder -->
                    <option value="Alberta">Alberta</option>
                    <option value="British Columbia">British Columbia</option>
                    <option value="Manitoba">Manitoba</option>
                    <option value="New Brunswick">New Brunswick</option>
                    <option value="Newfoundland and Labrador">Newfoundland and Labrador</option>
                    <option value="Nova Scotia">Nova Scotia</option>
                    <option value="Ontario">Ontario</option>
                    <option value="Prince Edward Island">Prince Edward Island</option>
                    <option value="Quebec">Quebec</option>
                    <option value="Saskatchewan">Saskatchewan</option>
                </select>
            </div>

            <div class="flex justify-center space-x-3 mt-8">
                <!-- Increased top margin for buttons -->
                <button type="submit" class="primary-button">
                    <!-- Using primary-button class -->
                    üîé Apply
                </button>
                <button type="button" onclick="clearFilters()" class="secondary-button">
                    <!-- Using secondary-button class -->
                    üîÑ Clear
                </button>
            </div>
        </form>
        <div class="mt-6 p-6 rounded-lg shadow-md border">
            <h2 class="text-lg font-semibold mb-3">üì• Download Data</h2>
            <p class="text-gray-600">Download the alumni obituaries data as a CSV file.</p>
            <div class="mt-3">
                <a href="{{ url_for('download_csv') }}" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                    ‚¨á Download CSV
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 bg-white rounded-lg shadow-md">
        <!-- UWindsor Alumni Portrait & Welcome -->
        <div class="flex items-center mb-8">
            <img src="{{ url_for('static', filename='images/alumnilogo.jpg') }}" alt="University of Windsor Alumni"
                 class="w-72 mr-6 rounded-md">
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-2">Welcome to the Alumni Obituary Dashboard</h2>
                <p class="text-gray-700">Explore recent alumni obituaries and manage the scraping process.</p>
            </div>
        </div>

        <!-- Dashboard Summary Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-blue-100 p-4 rounded-lg shadow-sm border-b-4 border-blue-400">
                <p class="text-gray-600 text-sm">Total Alumni Obituaries</p>
                <!--                <p class="text-2xl font-bold text-gray-800" id="alumniCount">{{ total_alumni }}</p>-->
                <p class="text-2xl font-bold text-gray-800" id="alumniCount">78</p>
            </div>
            <div class="bg-green-100 p-4 rounded-lg shadow-sm border-b-4 border-green-400">
                <p class="text-gray-600 text-sm">Total Obituaries Processed</p>
                <!--                <p class="text-2xl font-bold text-gray-800" id="entriesFetched">{{ total_obituaries }}</p>-->
                <p class="text-2xl font-bold text-gray-800" id="entriesFetched">294</p>
            </div>
            <div class="bg-yellow-100 p-4 rounded-lg shadow-sm border-b-4 border-yellow-400">
                <p class="text-gray-600 text-sm">Total Cities Processed</p>
                <!--                <p class="text-2xl font-bold text-gray-800" id="citiesFetched">{{ total_cities }}</p>-->
                <p class="text-2xl font-bold text-gray-800" id="citiesFetched">6</p>
            </div>
        </div>
        <!-- Scraper Controls -->
        <!-- index.html - Scraper Controls Section - RE-CORRECTED Button Logic -->
        <div class="mb-6 p-6 rounded-lg shadow-md border">
            <h2 class="text-lg font-semibold mb-3">‚öôÔ∏è Scraper Controls</h2>
            <p class="text-gray-600">Start or stop the obituary scraping process.</p>
            <div class="mt-4 flex space-x-3">
                <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600"
                        onclick="startScraping()" id="startButton">‚ñ∂ Start
                </button>
                <button class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                        onclick="stopScraping()" disabled id="stopButton">‚èπ Stop
                </button>
            </div>
            <p class="mt-2 text-gray-500" id="scrapingStatus">Not running</p>
        </div>


        <!-- Recent Obituaries Section -->
        <div class="rounded-lg shadow-md border">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-lg font-semibold">üìú Recent Alumni Obituaries</h2>
                <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
                        onclick="refreshObituaries()">
                    üîÑ Refresh
                </button>
            </div>
            <div id="obituaryList" style="max-height: 70vh; overflow-y: auto;">
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 table-fixed">
                        <thead class="bg-gray-200 sticky top-0">
                        <tr>
                            <th class="border px-4 py-2 text-left w-1/6">First Name</th>
                            <th class="border px-4 py-2 text-left w-1/6">Last Name</th>
                            <th class="border px-4 py-2 text-left w-1/6">City</th>
                            <th class="border px-4 py-2 text-left w-1/6">Province</th>
                            <th class="border px-4 py-2 text-left w-1/6">Birth Date</th>
                            <th class="border px-4 py-2 text-left w-1/6">Death Date</th>
                            <th class="border px-4 py-2 text-left w-1/6">Obituary URL</th>
                        </tr>
                        </thead>
                        <tbody class="obituary-table-body overflow-x-auto">
                        </tbody>
                    </table>
                </div>
                <div id="loading-spinner" class="text-center hidden p-6">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>Loading Obituaries...</p>
                </div>
                <p class="text-center py-4 text-gray-500 hidden" id="noNewEntries">No new entries found based on
                    filters.</p>
            </div>
        </div>
    </main>
</div>

</body>
</html>